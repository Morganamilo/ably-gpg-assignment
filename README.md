# Parity GPG Assignment

This repo contains my solutions to an assignment from Parity.

## Notes

Some notes I jotted down while working on these solutions can be found in `notes.md`

## Technical questions

The technical questions are answered in the file `technical-questions.md`

## Programming solution

The programming solution is split into multiple layers. There's the core Rust code that actually does the work. A dockerfile that wraps the rust solution. And a GitHub workflow that runs the dockerfile.

### Rust program

The Rust program is a simple binary that ingests a private key and 1 to 16 URLs. It downloads the files located at each `URL` and their accompanying signature files located at `$URL.asc`. It then verifies each signature against Parity's Public PGP key (or the test key included in this repo). If all files pass validation, each file is then signed with the private key specified. It then writes all downloaded files, the new signatures and a json summary to `/out`. As this directory is hard coded, it only really works when ran through the docker container.

The program expects the private key data to be passed in via stdin, and then each url passed as a command line argument.

Assuming /out exists. The program can be run with:

```
cargo run url < private_key
```

The test can be run with:

```
cargo test
```

### Docker

Running the program via docker is almost as trivial as through cargo.

To build the docker file in this repo use:

```
docker build . -t parity-gpg-assignment
```

The container can then be ran with:

```
mkdir out
docker run -i --rm -v $(pwd)/out:/out parity-gpg-assignment url < private_key
```

You can then find the files generated by this in the `out` directory.

### GitHub Workflow

This repo also contains a GitHub workflow that can be manually triggered to run the docker container. Although it runs the container uploaded to the docker registry, not the code in this repo directly.

When triggered, the workflow will ask for up to 3 URLs as input, do the verifying and signing, then upload the results as an artefact.

### Testing

For the purposes of testing, I have uploaded files and signatures to:

- https://pkgbuild.com/~morganamilo/keys/1
- https://pkgbuild.com/~morganamilo/keys/2
- https://pkgbuild.com/~morganamilo/keys/3

These files are signed by the test key included in this repo. The test private key is also located in this repo at `testdata/parity-secret-key` if you wish to sign your own files.
